<!-- ORDER OPEN -->
<div class="processing" [class.boxed]="boxed" *ngIf="getOrderState()=='authorized'" >
  <h3 i18n>{{i18n[locale].title_order_open}} {{order.oid}}</h3>

  <p class="help-block">
      {{i18n[locale].title_order_prepare}}&nbsp;
      <b>{{order.shipping.when|date:'EEE d MMM y':'':locale}}</b><br/>
      {{i18n[locale].title_order_shipping}} <b class="text-capitalize">{{order.shipping.name}}</b>
      &nbsp;<span [hidden]="!childOrderLength" class="ita">//{{childOrderLength}} {{i18n[locale].title_order_grouped}} </span>
  </p>
  <progress max="100" [value]="order.getProgress()/100+10" class="kng-progress"></progress>    
</div>

<!--- ORDER IS CANCEL -->
<div class="feedback" [class.boxed]="boxed" *ngIf="getOrderState()=='voided'">
  <div class="details" >
    <span class="bold">{{hubName}} </span>
    <span class="text-capitalize">{{order.shipping.when|date:'EEE d MMM y'}}</span>,
      {{i18n[locale].title_order_cancel}}
      <span class="text-strike">{{order.getTotalPrice()|currency:'CHF'}}</span>
  </div>                                      
</div>

<!--- ORDER IS EVALUATED -->
<div class="feedback" [class.boxed]="boxed" *ngIf="getOrderState()=='evaluated'">
  <div class="details" >
    <span class="bold">{{hubName}} </span>
    <span class="text-capitalize">{{order.shipping.when|date:'EEE d MMM y':'':locale}}</span>,
      {{order.items.length}} articles
      <span>{{order.getTotalPrice()|currency:'CHF'}}</span>
  </div>                                      
  <div class="form">
    <!-- Annulation {{order.getFulfilledFailure()}} - 
    Problème {{order.getFulfilledIssue().length}} -->
    <span>{{i18n[locale].title_evaluation}}</span>&nbsp;
    <span class="stars material-symbols-outlined" [class.scored]="score>=0">star_rate</span> 
    <span class="stars material-symbols-outlined" [class.scored]="score>=1">star_rate</span> 
    <span class="stars material-symbols-outlined" [class.scored]="score>=2">star_rate</span>
    <span class="stars material-symbols-outlined" [class.scored]="score>=3">star_rate</span>
  </div>
</div>


<!--- ORDER IS PAID -->
<div class="feedback" [class.boxed]="boxed" *ngIf="getOrderState()=='paid'">
  <ng-content></ng-content>
  <div class="details" >
      <span class="text-capitalize">{{order.shipping.when|date:'EEE d MMM'}}</span>
      <b>{{order.items.length}}</b> articles 
      <span>{{order.getTotalPrice()|currency:'CHF'}}</span>
      <button hidden class="action right">les article</button>
  </div>                   
                   
  <div class="form">
    <!-- Annulation {{order.getFulfilledFailure()}} - 
    Problème {{order.getFulfilledIssue().length}} -->
    <span>{{i18n[locale].title_evaluation_quick}}</span>&nbsp;
    <span class="stars material-symbols-outlined" (click)="evaluate(0)" [class.scored]="score>=0">star_rate</span> 
    <span class="stars material-symbols-outlined" (click)="evaluate(1)" [class.scored]="score>=1">star_rate</span> 
    <span class="stars material-symbols-outlined" (click)="evaluate(2)" [class.scored]="score>=2">star_rate</span>
    <span class="stars material-symbols-outlined" (click)="evaluate(3)" [class.scored]="score>=3">star_rate</span>    
  </div>
  <div class="evaluate" [hidden]="!displayEvaluate()" [class.boxed]="boxed">
    <div class="label">
      <span>{{i18n[locale].title_evaluation_save}}</span>
      <span class="stars material-symbols-outlined" (click)="evaluate(0)" [class.scored]="score>=0">star_rate</span> 
      <span class="stars material-symbols-outlined" (click)="evaluate(1)" [class.scored]="score>=1">star_rate</span> 
      <span class="stars material-symbols-outlined" (click)="evaluate(2)" [class.scored]="score>=2">star_rate</span>
      <span class="stars material-symbols-outlined" (click)="evaluate(3)" [class.scored]="score>=3">star_rate</span>      
      <button (click)="onEvaluate()" class="">{{i18n[locale].title_issue_send}} </button>      
    </div>
    <p class="block-info">
      <span [innerHtml]="i18n[locale].title_issue_subtitle"></span>
    </p>
  </div>

  <!-- ORDER ITEMS -->
  <!-- <ng-container 
    [ngTemplateOutlet]="orderItems"
    [ngTemplateOutletContext]="{ $implicit: order }">
  </ng-container> -->

</div>

<div class="customer">
  <div class="wallet" [class.boxed]="boxed">
    <div class="label">{{llabel.title_wallet}} </div>
    <div class="cash">{{balance}} CHF</div>
    <div class="gift">
      <input type="text" [placeholder]="llabel.title_code" [(ngModel)]="applyCode">
      <button (click)="onRedeem()" [disabled]="!applyCode"><span class="stars material-symbols-outlined">done</span></button>
    </div>
  </div>

  <div class="bill" [hidden]="!hasInvoice" [class.boxed]="boxed">
    <div class="label">{{i18n[locale].title_invoice_open}}</div>
    <div class="content">
      <p>{{qrbillContent|| 'Aucune facture ouverte'}}</p>
      <button class="print" [disabled]="!qrbillContent" (click)="printQr=true">Imprimer</button>  
    </div>
  </div>

  <div class="favorite" [class.boxed]="boxed">
    <div class="label">{{i18n[locale].title_favorite}}</div>
    <div class="content">
      <p>{{i18n[locale].title_favorite_p}}</p>
      <button (click)="onFavorites()">OPEN</button>
    </div>
  </div>


  <div class="history" [class.boxed]="boxed" *ngIf="getOrderState()=='paid'">
    <div class="label">La commande {{order.shipping.when|date:'d MMM'}}, {{order.getTotalPrice()|currency:'CHF'}}</div>
    <div class="content">
      <p>
        <span [innerHtml]="i18n[locale].title_issue_subtitle"></span>
      </p>
      <button (click)="openIssue()" class="issue" >{{i18n[locale].title_issue_question}}</button>    
    </div>
  </div>

  <div class="subscription" [class.boxed]="boxed">
    <div class="label">{{i18n[locale].title_subscription}}</div>
    <div class="content">Aucun abonnement actif</div>
  </div>
      
</div>
<!--- DISPLAY INVOICES -->
<div class="qrbill" [hidden]="!printQr" [class.qr-fullscreen]="printQr">
  <h3>La facture à immprimer</h3>
  <div class="svg" #qrbill></div> 
  <p>Les code des commandes: {{qrbillContent}}</p>
  <div class="actions">
    <button (click)="onUpdateInvoices()">{{i18n[locale].title_order_payment_done}}</button>
    <button class="close" (click)="printQr=false">FERMETURE</button>
  </div>
</div>

<!-- FEEDBACK POPUP -->
<ng-container *ngIf="askFeedback">
  <div class="blured" ></div>
  <div class="container top">
    <button (click)="onBack()" class="close">
        <span class="size-xlarge  material-symbols-outlined">close</span>
    </button>
    <div class="feedback-container" >
      <h2>{{i18n[locale].title_issue_title}}</h2>

      <div class="stars">

      </div>

      <p [innerHtml]="i18n[locale].title_issue_header"></p>

      <!-- ORDER ITEMS -->
      <ng-container 
        [ngTemplateOutlet]="orderItems"
        [ngTemplateOutletContext]="{ $implicit: order }">
      </ng-container>


      <div class="breaker small"></div>

      <!-- ORDER FEEDBACK -->

      <label for="feedback">{{i18n[locale].title_issue_hub}}</label>

      <textarea kng-autosize rows="2" [(ngModel)]="feedbackText"> </textarea>                  

      <!-- FEEDBACK ACTIONS -->
      <button  (click)="onEvaluate()" [disabled]="">{{i18n[locale].title_issue_send}}</button>

    </div>
  </div>    
</ng-container>

<!-- ITEMS POPUP -->

<ng-container *ngIf="selectedOrder">

  <div class="blured" ></div>
  <div class="container top">
    <button (click)="onBack()" class="close">
        <span class="size-xlarge  material-symbols-outlined">close</span>
    </button>
    <div class="feedback-container" >
      <h2>Commande</h2>
      <p> commande </p>

      <!-- ORDER ITEMS -->
      <ng-container 
        [ngTemplateOutlet]="orderItems"
        [ngTemplateOutletContext]="{ $implicit: selectedOrder }">
      </ng-container>


      <div class="breaker small"></div>

      <!-- ORDER FEEDBACK -->

      <!-- FEEDBACK ACTIONS -->
      <button  (click)="onEvaluate()" [disabled]="">pouet</button>

    </div>
  </div>    

</ng-container>

<ng-template #orderItems let-order>
  <ul>
    <li *ngFor="let item of order.items"
        [class.selected]="selected[item.sku]" >
        <div class="header"(click)="selected[item.sku]=!selected[item.sku]">
          <input type="checkbox" [checked]="selected[item.sku]" [(ngModel)]="selected[item.sku]">
          {{item.quantity}}x {{item.title}} ({{item.part}})  
        </div>
        <div class="content" [hidden]="!selected[item.sku]">
          <label for="story">Description/Describe:</label>
          <textarea id="story" class=""  rows="2" [(ngModel)]="item.note" kng-autosize>
          </textarea>
        </div>
    </li>
  </ul>
  <ul *ngFor="let complement of childOrder[order.oid]">
    <li class="bold">En complément</li>
    <li *ngFor="let item of complement.items"
        [class.selected]="selected[item.sku]">

        <div class="header"(click)="selected[item.sku]=!selected[item.sku]">
          <input type="checkbox" [checked]="selected[item.sku]" [(ngModel)]="selected[item.sku]">
          {{item.quantity}}x {{item.title}} ({{item.part}})  
        </div>
        <div class="content" [hidden]="!selected[item.sku]">
          <label for="story">Description/Describe:</label>
          <textarea id="story" class=""  rows="2" [(ngModel)]="item.note" kng-autosize>
          </textarea>
        </div>
    </li>
  </ul>
  <ul hidden>
    <li class="add-to-cart">                
      <a href="javascript:;" class="black smaller "                    
      (click)="onAddAllToCart()" i18n>
      <i class="material-symbols-outlined " style="transform: translateY(5px);font-size:16px;">add_shopping_cart</i>{{i18n[locale].title_add_all_to_cart}}</a>             
    </li>

  </ul>

</ng-template>