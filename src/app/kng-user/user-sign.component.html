<div class="blured" [hidden]="isReady"></div>
<div class="container top">

  <button (click)="onBack()" class="close">
      <span class="material-symbols-outlined size-large">close</span>
  </button>
  <div class="k-brand">
    <img class="icon" src="/assets/img/k-puce-light.png" /> &nbsp; {{$i18n[locale].karibou_project}}
  </div>

  <div class="sign" >

    <div class="logo"
         [ngStyle]="taglineLogo"
         [class.small]="askAction=='signup'"
         [routerLink]="['/store',hubSlug,'home']"
         [hidden]="askAction=='payment'||askAction=='address'"></div>

    <!-- LOGIN -->
    <div class="inner" *ngIf="!askAction">
      <h3 >{{i18n[locale].login_title}}</h3>
      <p class="help-block" [innerHtml]="i18n[locale].login_why">
      </p>

      <form [formGroup]="sign" (submit)="onSign()">
          <div class="groupfield">
            <input class="form__field" autocomplete autofocus [type]="authlink" [placeholder]="$i18n[locale].user_email" formControlName="email" />
            <label class="form__label">{{$i18n[locale].user_email}}</label>
          </div>
          <kng-control-messages [control]="sign.controls.email"></kng-control-messages>

          <div class="groupfield">
            <input class="form__field" autocomplete type="password" [placeholder]="$i18n[locale].user_password" formControlName="password" />
            <label class="form__label">{{$i18n[locale].user_password}}</label>
          </div>
          <kng-control-messages [control]="sign.controls.password"></kng-control-messages>

          <button class="button primary" [disabled]="!sign.valid">
            <span class="material-symbols-outlined">account_circle</span>
            <span >Login</span>
          </button>
      </form>
      <div class="signup-vs-login black" ><a class="link" (click)="askAction='signup'">{{i18n[locale].login_create_account}}</a></div>
      <div class="signup-vs-login black" ><a class="link black" [routerLink]="['/store',hubSlug,'home']">{{i18n[locale].login_skip}}</a></div>
      <div class="signup-vs-login light" ><a class="link" (click)="askAction='recover'">{{i18n[locale].login_forgot_password}}</a></div>
    </div>

    <!-- RECOVER -->
    <div class="inner" *ngIf="askAction=='recover'">
      <h3 >{{i18n[locale].login_reset_password}}</h3>
      <form [formGroup]="recover" (submit)="onRecover()">
          <div class="groupfield">
            <input class="form__field" type="email" [placeholder]="$i18n[locale].user_email" formControlName="email" />
            <label class="form__label">{{$i18n[locale].user_email}}</label>
          </div>
          <kng-control-messages [control]="recover.controls.email"><span >{{i18n[locale].login_wait_msg}}</span></kng-control-messages>
          <button class="button primary" [disabled]="!recover.valid || sendRecover">
            <span class="material-symbols-outlined">account_circle</span>
            <span >{{sendRecover ? i18n[locale].action_reset_done : i18n[locale].action_reset}}</span>
          </button>
      </form>
      <div class="signup-vs-login" ><a class="link" (click)="askAction=null">{{i18n[locale].login_back_login}}</a></div>
    </div>

    <!-- SIGNUP -->
    <div class="inner" *ngIf="askAction=='signup'">
      <form [formGroup]="signup" (submit)="onSignup()">
          <div class="groupfield">
            <input class="form__field" type="text" [placeholder]="$i18n[locale].user_name" formControlName="name" />
            <label class="form__label">{{$i18n[locale].user_name}}</label>
          </div>
          <kng-control-messages [control]="signup.controls.name"></kng-control-messages>
          
          <div class="groupfield">
            <input class="form__field" type="text" [placeholder]="$i18n[locale].user_firstname" formControlName="forname" />
            <label class="form__label">{{$i18n[locale].user_firstname}}</label>
          </div>
          <kng-control-messages [control]="signup.controls.forname"></kng-control-messages>

          <div class="groupfield" [hidden]="mandatory.minimal">
            <input class="form__field" type="text" [placeholder]="$i18n[locale].user_postalcode" formControlName="postalcode" />
            <label class="form__label">{{$i18n[locale].user_postalcode}}</label>
          </div>
          <kng-control-messages [hidden]="mandatory.minimal" [control]="signup.controls.postalcode"></kng-control-messages>

          <div class="groupfield">
            <input class="form__field" type="text" [placeholder]="$i18n[locale].user_phone" formControlName="phone" />
            <label class="form__label">{{$i18n[locale].user_phone}}</label>
          </div>
          <p class="help-block phone-hide" >
            {{i18n[locale].signup_phone}}
          </p>

          <div class="groupfield">
            <input class="form__field" type="email" [placeholder]="$i18n[locale].user_email" formControlName="email" />
            <label class="form__label">{{$i18n[locale].user_email}}</label>
          </div>
          <kng-control-messages [control]="signup.controls.email"></kng-control-messages>

          <div class="groupfield">
            <input class="form__field" type="password" [placeholder]="$i18n[locale].user_password" formControlName="password" />
            <label class="form__label">{{$i18n[locale].user_password}}</label>
          </div>
          <kng-control-messages [control]="signup.controls.password"></kng-control-messages>

          <div class="groupfield">
            <input class="form__field" type="password" [placeholder]="$i18n[locale].user_repassword" formControlName="confirm" />
            <label class="form__label">{{$i18n[locale].user_repassword}}</label>
          </div>
          <kng-control-messages [control]="signup.controls.confirm"></kng-control-messages>

          <button class="button primary" [disabled]="!signup.valid">
            <span tabindex="-1" class="material-symbols-outlined">account_circle</span>
            <span >{{i18n[locale].signup_create}}</span>
          </button>
      </form>
      <div class="signup-vs-login" ><a class="link" (click)="askAction=null">{{i18n[locale].login_back_login}}</a></div>
    </div>

    <!-- ADDRESS -->
    <div class="inner" *ngIf="askAction=='address'">
      <kng-user-address [user]="user" [config]="config" (updated)="onUpdateAddress($event)"></kng-user-address>
    </div>

    <!-- PAYMENT -->
    <div class="inner" *ngIf="askAction=='payment'">
      <kng-user-payment-page [user]="user" [config]="config" (updated)="onUpdatePayment($event)"></kng-user-payment-page>
    </div>

    <!-- LOGOUT -->
    <div class="inner" *ngIf="askAction=='logout'">
      <h3 >{{i18n[locale].login_ok}}</h3>
      <div class="signup-vs-login" ><a class="link" (click)="askAction='login'">{{i18n[locale].login_back_login}}</a></div>
    </div>

  </div>
</div>
