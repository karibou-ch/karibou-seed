# Documentation Technique - Page Home

## Vue d'ensemble

La page Home (`kng-home`) est le point d'entrée principal de l'application. Elle affiche les catégories de produits, les produits mis en avant, et permet la navigation vers les différentes sections du site.

## Architecture

### Fichiers principaux

| Fichier | Rôle |
|---------|------|
| `src/app/kng-home/kng-home.component.ts` | Logique du composant |
| `src/app/kng-home/kng-home.component.html` | Template HTML |
| `src/app/kng-home/kng-home.component.scss` | Styles spécifiques |
| `src/styles/kng-side-menu.scss` | Styles menu desktop |
| `src/styles/kng-side-menu-mobile.scss` | Styles menu mobile (grille cartes) |
| `src/styles/colors.scss` | Palette de couleurs catégories |

### Structure de la page (Layout 3 colonnes)

```
┌─────────────────────────────────────────────────────────────┐
│                        HEADER (navbar)                       │
├──────────────┬─────────────────────────┬────────────────────┤
│              │                         │                    │
│   PANEL      │      PANEL CENTER       │    PANEL RIGHT     │
│   SIDE       │                         │                    │
│              │  - Calendar             │  - Aide/Contact    │
│  - Liens     │  - Produits pinned      │  - Audio support   │
│  - Catégories│  - Liste produits       │  - Recherche       │
│              │                         │                    │
├──────────────┴─────────────────────────┴────────────────────┤
│                        FOOTER (mobile)                       │
└─────────────────────────────────────────────────────────────┘
```

---

## Système de Catégories

### Variables principales

| Variable | Type | Description |
|----------|------|-------------|
| `categories` | `Category[]` | Toutes les catégories (master data) |
| `availableCategories` | `{ [name: string]: boolean }` | Catégories avec produits disponibles |
| `cached.categories` | `Category[]` | Cache des catégories filtrées |

### Flux de données

```
1. Chargement page
   └─> categories = $loader.getLatestCoreData().categories
   └─> availableCategories = {}

2. Chargement produits (productsGroupByCategory)
   └─> Pour chaque catégorie dans hub.categories
       └─> availableCategories[cat.name] = true

3. Affichage menu (sortedCategories getter)
   └─> categories.filter(c => availableCategories[c.name])
```

### Use cases

| Scénario | Variable utilisée |
|----------|-------------------|
| Afficher tous les thèmes | `categories.filter(c => c.type === 'theme')` |
| Afficher catégories actives | `sortedCategories` (getter) |
| Réinitialiser filtres | `clearCategory()` → reset `availableCategories` |
| Après recherche | Mise à jour `availableCategories` avec résultats |

### Modèle Category

```typescript
interface Category {
  _id: string;
  name: string;
  slug: string;          // Identifiant URL-friendly
  type: string;          // 'Category' | 'Group' | 'theme'
  active: boolean;
  weight: number;        // Ordre d'affichage
  image: string;         // Classe CSS pour icône
  cover: string;         // URL image de fond
}
```

---

## Affichage Mobile - Grille Catégories

### Design

Sur mobile (≤599px) et tablet (600-1199px), les catégories s'affichent en grille de cartes avec :
- **3 colonnes** sur mobile
- **4 colonnes** sur tablet
- **Couleurs cycliques** automatiques (8 couleurs pastel)
- **Images de fond** pour catégories favorites

### Classes CSS

| Classe | Description |
|--------|-------------|
| `.subs-item` | Carte de catégorie de base |
| `.subs-item.inverted` | Carte avec fond foncé (liens spéciaux) |
| `.subs-item.has-image` | Carte avec image de fond |
| `.subs-item.selected` | Carte sélectionnée |
| `.category-label` | Label de la catégorie |
| `.category-badge` | Badge optionnel en haut |

### Activation des images

```html
<li class="subs-item"
    [class.has-image]="hasCategoryImage(category)"
    [style.--cat-image]="hasCategoryImage(category) ? 'url(' + category.cover + ')' : null">
```

```typescript
// kng-home.component.ts
hasCategoryImage(category: Category): boolean {
  const categoriesWithImage = [
    'fruits',
    'poissonneries',
    'charcuteries-et-pates',
    'vins-rouges',
    'fleurs'
  ];
  return categoriesWithImage.includes(category.slug) && !!category.cover;
}
```

### Palette de couleurs (cycle automatique)

Les couleurs sont définies dans `src/styles/colors.scss` :

| Variable | Couleur | Usage |
|----------|---------|-------|
| `--cat-color-1` | Vert pastel | Dérivé de `--mdc-theme-karibou-green` |
| `--cat-color-2` | Turquoise pastel | Dérivé de `--mdc-theme-primary` |
| `--cat-color-3` | Rose pastel | Dérivé de `--mdc-theme-karibou-pink` |
| `--cat-color-4` | Jaune pastel | Dérivé de `--mdc-theme-karibou-yellow` |
| `--cat-color-5` | Indigo pastel | #6366f1 mixé |
| `--cat-color-6` | Orange pastel | #f97316 mixé |
| `--cat-color-7` | Teal pastel | Dérivé de `--mdc-theme-secondary` |
| `--cat-color-8` | Violet pastel | #a855f7 mixé |

Le cycle s'applique automatiquement via `:nth-child(8n+X)`.

---

## Breakpoints

| Breakpoint | Comportement |
|------------|--------------|
| **Mobile** (≤599px) | Grille 3 colonnes, swipe horizontal |
| **Tablet** (600-1199px) | Grille 4 colonnes, swipe horizontal |
| **Desktop** (≥1200px) | Menu liste vertical, sticky |

---

## Structure HTML du menu

```html
<div class="swipe-panel side">
  <div class="menu-panel">
    
    <!-- Liens spéciaux (mobile) -->
    <ul class="subs">
      <li class="subs-item inverted">FAVORIS</li>
      <li class="subs-item inverted">B2B</li>
      <li class="subs-item inverted">ABONNEMENTS</li>
      <li class="subs-item inverted">JAMES (Assistant)</li>
    </ul>

    <!-- Liens desktop -->
    <ul class="hide-sm">
      <li>Mon compte</li>
      <li>Abonnements</li>
      ...
    </ul>

    <!-- Catégories (mobile + desktop) -->
    <ul>
      <li class="subs-item" *ngFor="let category of sortedCategories">
        <i [class]="category.image"></i>
        <span class="category-label">{{category.name}}</span>
      </li>
    </ul>

  </div>
</div>
```

---

## Méthodes principales

### `productsGroupByCategory(emit)`

Charge les produits et met à jour `availableCategories`.

```typescript
// Déclenché par : CART_INIT, CART_LOADED, CART_SHIPPING
productsGroupByCategory(emit) {
  // 1. Reset des catégories
  this.clearCategory();
  
  // 2. Chargement produits avec options
  const options = {
    when: this.currentShippingDay.toISOString(),
    hub: this.$navigation.store,
    pinned: true,
    // ...
  };
  
  // 3. Mise à jour availableCategories
  this.categories.forEach(cat => {
    this.availableCategories[cat.name] = (
      this.hub.categories.indexOf(cat._id) > -1 || 
      !this.hub.categories.length
    );
  });
}
```

### `scrollToSlug(slug)`

Navigation vers une catégorie.

```typescript
scrollToSlug(slug: string) {
  this.categorySlug = slug;      // Déclenche scroll dans product-list
  this.displaySlug = slug;       // Met à jour l'état sélectionné
}
```

### `getCategoryI18n(cat)`

Récupère le nom traduit de la catégorie.

```typescript
getCategoryI18n(cat) {
  const key = 'category_name_' + cat.slug.replace(/-/g, '_');
  return this.label[key] || cat.name;
}
```

---

## TODO / Évolutions futures

- [ ] Remplacer le hardcoding de `hasCategoryImage()` par logique basée sur préférences utilisateur
- [ ] Ajouter statistiques d'achat pour déterminer catégories favorites
- [ ] Support configuration hub pour catégories avec image
- [ ] Optimisation performance avec `trackBy` sur ngFor des catégories
